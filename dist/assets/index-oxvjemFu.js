import"./preload-helper-BxaVoaJg.js";import{c as C}from"./index-DnGFXnjs.js";document.addEventListener("DOMContentLoaded",()=>{const c=C("https://tzbqdjwgbisntzljwbqp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6YnFkandnYmlzbnR6bGp3YnFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0MTQyNTUsImV4cCI6MjA3MTk5MDI1NX0.fl0GBdHF_Pc56FSCVkKmCrCQANMVGvQ8sKLDoqK7eAQ"),d=document.getElementById("container"),g=document.getElementById("showRegisterBtn"),u=document.getElementById("showLoginBtn"),v=document.getElementById("loginForm"),n=document.getElementById("pinLogin"),t=document.getElementById("loginMsg"),I=document.getElementById("forgotPinBtn");g&&g.addEventListener("click",()=>{d.classList.add("active"),L()}),u&&u.addEventListener("click",()=>{d.classList.remove("active")});async function p(i){t.classList.remove("info"),t.textContent="Verificando...";const{data:e,error:r}=await c.from("Logins").select("*").eq("PIN",i).single();if(r||!e){t.textContent="PIN inválido ou erro na conexão.";return}if(e.Aprovacao!=="SIM"){t.textContent="Acesso pendente de aprovação.";return}localStorage.setItem("userSession",JSON.stringify(e)),window.location.href="/dashboard.html"}v&&v.addEventListener("submit",async i=>{i.preventDefault(),n.value.length===6?p(n.value):t.textContent="O PIN deve ter 6 dígitos."}),n&&n.addEventListener("input",()=>{n.value.length<6&&(t.textContent="",t.classList.remove("info")),n.value.length===6&&p(n.value)}),I&&I.addEventListener("click",()=>{t.textContent="Entre em contato conosco! Valdemi.silva@Kuehne-nagel.com",t.classList.add("info"),t.classList.remove("error")});const l=document.getElementById("registerForm"),E=document.getElementById("registerEmail"),s=document.getElementById("registerMatriz"),f=document.getElementById("registerPin"),o=document.getElementById("registerMsg");async function L(){s.innerHTML='<option value="" disabled selected>Carregando...</option>';const{data:i,error:e}=await c.from("Matrizes").select("MATRIZ");if(e){s.innerHTML='<option value="" disabled selected>Erro ao carregar</option>',console.error("Erro ao buscar matrizes:",e);return}const r=Array.from(new Set(i.map(a=>a.MATRIZ))).sort();s.innerHTML='<option value="" disabled selected>Selecione a Matriz</option>',r.forEach(a=>{const m=document.createElement("option");m.value=a,m.textContent=a,s.appendChild(m)})}l&&l.addEventListener("submit",async i=>{i.preventDefault(),o.textContent="Enviando...",o.classList.remove("error");const e={email:E.value,matriz:s.value,pin:f.value};if(!e.email||!e.matriz||!/^\d{6}$/.test(e.pin)){o.classList.add("error"),o.textContent="Todos os campos são obrigatórios.";return}const{error:r}=await c.from("Logins").insert({PIN:e.pin,Usuario:e.email.toLowerCase(),Matriz:e.matriz,Nivel:"Usuario",Aprovacao:"PENDENTE"});r?(o.classList.add("error"),o.textContent="Erro: Este PIN ou Email já pode estar em uso.",console.error("Erro no registro:",r)):(o.textContent="Solicitação enviada! Aguarde a aprovação.",l.reset(),setTimeout(()=>{d.classList.remove("active")},3e3))})});
